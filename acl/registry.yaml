# Nova Civilizational Architecture ACL Registry
# Defines capabilities, ownership, and governance for critical system components

version: "1.0"
schema: "capability_registry"

meta:
  owner: nova-meta-controller
  updated: 2025-09-15
  notes: "ACL registry for Slot 8 & Slot 4 Processual capabilities"

capabilities:
  # Slot 8 Memory Lock & IDS Capabilities (Processual 4.0)
  - key: MEM/SELF_HEAL@1
    owner: slot08
    status: active
    desc: Self-healing memory with signed snapshots, quarantine, adaptive repair
    requires: [MEM/SNAPSHOT_SIGNING@1, MEM/QUARANTINE_POLICY@1, IDS/STORE_SURGE@1]
    tests:
      - slots/slot08_memory_lock/tests/test_processual_capabilities.py::TestProcessualCapabilities::test_mttr_requirement
      - slots/slot08_memory_lock/tests/test_self_healing_integration.py::TestSelfHealingIntegration::test_end_to_end_recovery_workflow

  - key: MEM/QUARANTINE_POLICY@1
    owner: slot08
    status: active
    desc: Versioned quarantine policy with activation <=1s, auto-recovery, read-only continuity
    tests:
      - slots/slot08_memory_lock/tests/test_processual_capabilities.py::TestProcessualCapabilities::test_quarantine_flip_time

  - key: IDS/STORE_SURGE@1
    owner: slot08
    status: active
    desc: Write-surge detection that emits structured events
    tests:
      - slots/slot08_memory_lock/tests/test_processual_capabilities.py::TestProcessualCapabilities::test_autonomous_threat_detection

  - key: MEM/SNAPSHOT_SIGNING@1
    owner: slot08
    status: active
    desc: Ed25519 snapshot manifest signing & verification
    tests: []

  # Slot 4 TRI Engine Capabilities (Processual 4.0)
  - key: TRI/PATTERN_DETECT@1
    owner: slot04
    status: active
    desc: Drift/surge detection for TRI streams with O(1) rolling stats
    tests:
      - slots/slot04_tri/tests/test_processual_tri.py::test_autonomous_detection_and_recovery
      - slots/slot04_tri/tests/test_processual_tri.py::test_surge_respects_warmup

  - key: TRI/CALCULATE@1
    owner: slot04
    status: active
    desc: TRI scoring with confidence intervals and safe-mode gating
    requires: [TRI/PATTERN_DETECT@1, TRI/CONFIDENCE_BOUNDS@1]
    tests:
      - slots/slot04_tri/tests/test_processual_tri.py::test_confidence_interval_behavior
      - slots/slot04_tri/tests/test_processual_tri.py::test_safe_mode_continuity
      - slots/slot04_tri/tests/test_processual_tri.py::test_threshold_adapts_and_reverts

  - key: TRI/CONFIDENCE_BOUNDS@1
    owner: slot04
    status: active
    desc: Statistical confidence interval calculation with adaptive thresholds
    tests:
      - slots/slot04_tri/tests/test_processual_tri.py::test_confidence_interval_behavior

  - key: TRI/SAFE_MODE@1
    owner: slot04
    status: active
    desc: Production-grade safe mode with monotonic timing and auto-expiry
    tests:
      - slots/slot04_tri/tests/test_processual_tri.py::test_safe_mode_continuity

  - key: TRI/SNAPSHOT@1
    owner: slot04
    status: active
    desc: Signed TRI model snapshots with path-bound Merkle verification
    tests:
      - slots/slot04_tri/tests/test_processual_tri.py::test_snapshot_ops

  # Slot 10 Civilizational Deployment Capabilities (Processual 4.0)
  - key: DEPLOY/GATEKEEPER@1
    owner: slot10
    status: active
    desc: Gate evaluation using Slot 8/4 health signals for deployment decisions
    requires: [MEM/SELF_HEAL@1, TRI/CALCULATE@1]
    tests:
      - slots/slot10_civilizational_deployment/tests/test_gates.py::test_gate_block_on_quarantine
      - slots/slot10_civilizational_deployment/tests/test_gates.py::test_gate_block_on_drift

  - key: DEPLOY/CANARY@1
    owner: slot10
    status: active
    desc: Progressive delivery controlled by ACL gates with autonomous rollback
    requires: [DEPLOY/GATEKEEPER@1, MEM/SELF_HEAL@1, TRI/CALCULATE@1]
    tests:
      - slots/slot10_civilizational_deployment/tests/test_canary.py::test_canary_promotes_when_all_green
      - slots/slot10_civilizational_deployment/tests/test_canary.py::test_canary_rolls_back_on_slo_violation

  - key: DEPLOY/SNAPSHOT_BACKOUT@1
    owner: slot10
    status: active
    desc: Cross-slot snapshot coordination for consistent rollback
    requires: [MEM/SNAPSHOT_SIGNING@1, TRI/SNAPSHOT@1]
    tests:
      - slots/slot10_civilizational_deployment/tests/test_backout.py::test_cross_slot_rollback

# System Integration Gates (top-level)
gates:
  slot10_deploy:
    description: "Deployment gate requiring Slot 8 & TRI health before Slot 10 promotion"
    conditions:
      - slot08.integrity_score >= 0.7
      - slot08.quarantine_active == false
      - slot08.recent_recoveries.success_rate_5m >= 0.8
      - slot04.safe_mode_active == false
      - slot04.drift_z < 3.0

  slot4_data_guard:
    description: "Data guard blocking TRI training input during integrity violations"
    conditions:
      - slot08.checksum_mismatch == false
      - slot08.tamper_evidence == false
    fallback: "read-only snapshot materialized views"