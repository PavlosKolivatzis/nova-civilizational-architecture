________________


1. OpenAPI 3.1 Specification (YAML)
openapi: 3.1.0
info:
  title: NOVA Reflex Map WebSocket API
  version: 1.0.0
servers:
  - url: wss://<host>/nova/reflex
    description: Production Reflex Event Stream
paths: {}
components:
  schemas:
    Envelope:
      $ref: './schemas/envelope-1.0.json'
    ReflexCycle:
      $ref: './schemas/cycle-1.0.json'
    SlotMetrics:
      $ref: './schemas/slot-metrics-1.0.json'
    TriUpdate:
      $ref: './schemas/tri-update-1.0.json'
    DeltathreshLayers:
      $ref: './schemas/deltathresh-layers-1.0.json'
    CultureDelta:
      $ref: './schemas/culture-delta-1.0.json'
    PedigreeAppend:
      $ref: './schemas/pedigree-append-1.0.json'
    ConsensusHealth:
      $ref: './schemas/consensus-health-1.0.json'
    Heartbeat:
      $ref: './schemas/heartbeat-1.0.json'


________________


2. Bundled JSON Schema Library
Directory structure for validation modules:
schemas/
  envelope-1.0.json
  cycle-1.0.json
  slot-metrics-1.0.json
  tri-update-1.0.json
  deltathresh-layers-1.0.json
  culture-delta-1.0.json
  pedigree-append-1.0.json
  consensus-health-1.0.json
  heartbeat-1.0.json


Each file contains the Draft 2020-12 schema you’ve already approved, with $id set to https://schemas.nova/reflex/{name}-1.0.json.
________________


3. Mock WebSocket Server (Node.js / ws)
import WebSocket, { WebSocketServer } from 'ws';
import fs from 'fs';
import path from 'path';


const wss = new WebSocketServer({ port: 8080 });
const schemas = {}; // optional: load JSON Schemas for validation


function sendEvent(ws, event) {
  ws.send(JSON.stringify(event));
}


function randomTriUpdate() {
  return {
    v: "1.0",
    event: "tri.update",
    id: "evt_" + Date.now(),
    at: new Date().toISOString(),
    source: "slot4",
    severity: "info",
    trace_id: "trc_" + Math.random().toString(36).substring(2, 10),
    cycle_id: "rc_demo",
    payload: {
      mode: "adaptive",
      tri: { score: 0.78, ci: [0.75, 0.81], entropy: 0.62, coherence: 0.84 },
      layers: { delta: 0.92, sigma: 0.88, theta: 0.90, omega: 0.91 },
      notes: "demo coherence increase"
    }
  };
}


wss.on('connection', ws => {
  console.log('Client connected');
  ws.on('message', msg => console.log('Received:', msg.toString()));
  setInterval(() => sendEvent(ws, randomTriUpdate()), 2000);
});


console.log('Mock NOVA Reflex WebSocket server running on ws://localhost:8080');


________________


4. React/TSX Frontend Hooks (TypeScript)
import { useEffect, useRef, useState } from 'react';


type EventEnvelope = {
  v: string;
  event: string;
  id: string;
  at: string;
  source: string;
  severity: string;
  payload: any;
};


export function useNovaReflex(
  url: string,
  topics?: string[]
): { events: EventEnvelope[]; send: (msg: any) => void } {
  const [events, setEvents] = useState<EventEnvelope[]>([]);
  const wsRef = useRef<WebSocket>();


  useEffect(() => {
    const ws = new WebSocket(url);
    wsRef.current = ws;
    ws.onopen = () => {
      if (topics) {
        ws.send(JSON.stringify({ action: 'subscribe', topics }));
      }
    };
    ws.onmessage = e => {
      try {
        const evt = JSON.parse(e.data);
        setEvents(prev => [evt, ...prev].slice(0, 50));
      } catch {}
    };
    return () => ws.close();
  }, [url, topics]);


  return {
    events,
    send: msg => wsRef.current?.send(JSON.stringify(msg))
  };
}


________________


✅ What you get with this bundle:
* Full OpenAPI spec for integration & tooling
* Versioned JSON Schemas for validation and forward-compatibility
* Mock server for dev/testing without the live NOVA feed
* React hook for instant dashboard binding
If you want, I can zip this as a ready-to-deploy repo with package.json, build scripts, and a sample Dashboard.tsx that renders TRI, cultural delta, pedigree timeline, and consensus health in real time. That would make it plug-and-play for your Phase 4 command center.
Do you want me to produce that zipped deployment repo now?