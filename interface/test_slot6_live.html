<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVA Slot 6 - Live Testing Interface</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .testing-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            color: #2563eb;
            margin-bottom: 20px;
            font-size: 1.25rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2563eb;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background: #1d4ed8;
        }
        
        .results-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .results-header {
            margin-bottom: 20px;
        }
        
        .results-header h3 {
            color: #2563eb;
            margin: 0;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 8px;
        }
        
        .metric-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }
        
        .details-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .detail-item {
            margin-bottom: 15px;
        }
        
        .detail-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .detail-value {
            color: #6b7280;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .testing-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .details-grid {
                grid-template-columns: 1fr;
            }
            .metric-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç NOVA Slot 6 Live Testing</h1>
            <p>Production-grade multicultural truth synthesis engine</p>
        </div>

        <div class="testing-grid">
            <!-- Institution Configuration -->
            <div class="card">
                <h3>üèõÔ∏è Institution Configuration</h3>
                <div class="form-group">
                    <label for="institutionName">Institution Name</label>
                    <input type="text" id="institutionName" class="form-control" placeholder="Stanford University" value="Stanford University">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="region">Region</label>
                        <select id="region" class="form-control">
                            <option value="US">United States</option>
                            <option value="EU">Europe</option>
                            <option value="EA">East Asia</option>
                            <option value="LA">Latin America</option>
                            <option value="AF">Africa</option>
                            <option value="ME">Middle East</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="language">Primary Language</label>
                        <select id="language" class="form-control">
                            <option value="en">English</option>
                            <option value="de">German</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="ja">Japanese</option>
                            <option value="zh">Chinese</option>
                            <option value="ar">Arabic</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="empiricism">Empiricism Priority: <span id="empiricismValue">0.8</span></label>
                        <input type="range" id="empiricism" class="form-control" min="0" max="1" step="0.1" value="0.8">
                    </div>
                    
                    <div class="form-group">
                        <label for="foresight">Foresight Priority: <span id="foresightValue">0.6</span></label>
                        <input type="range" id="foresight" class="form-control" min="0" max="1" step="0.1" value="0.6">
                    </div>
                </div>
            </div>

            <!-- Guardrail Testing -->
            <div class="card">
                <h3>üõ°Ô∏è Guardrail Testing</h3>
                <div class="form-group">
                    <label for="testContent">Test Content</label>
                    <textarea id="testContent" class="form-control" rows="6" placeholder="Enter content to test...">We propose evidence-based curriculum reforms to improve educational outcomes across diverse student populations.</textarea>
                </div>

                <div class="form-group">
                    <label for="institutionType">Institution Type</label>
                    <select id="institutionType" class="form-control">
                        <option value="academic">Academic</option>
                        <option value="media">Media</option>
                        <option value="government">Government</option>
                        <option value="ngo">NGO</option>
                        <option value="corporate">Corporate</option>
                    </select>
                </div>

                <button id="analyzeBtn" class="btn" style="width: 100%; margin-bottom: 10px;">
                    üß™ Analyze Cultural Profile
                </button>

                <button id="testGuardrailsBtn" class="btn" style="width: 100%;">
                    üõ°Ô∏è Test Guardrails
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section hidden">
            <div class="results-header">
                <h3>üìä Analysis Results</h3>
            </div>

            <!-- Metrics Grid -->
            <div class="metric-grid">
                <div class="metric-card">
                    <div id="adaptationEffectiveness" class="metric-value">0.847</div>
                    <div class="metric-label">Adaptation Effectiveness</div>
                </div>
                <div class="metric-card">
                    <div id="individualismIndex" class="metric-value">0.750</div>
                    <div class="metric-label">Individualism Index</div>
                </div>
                <div class="metric-card">
                    <div id="complianceScore" class="metric-value">1.000</div>
                    <div class="metric-label">Compliance Score</div>
                </div>
                <div class="metric-card">
                    <div id="culturalContext" class="metric-value">MIXED</div>
                    <div class="metric-label">Cultural Context</div>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="details-section">
                <h4 style="margin-bottom: 20px; color: #374151;">üìã Detailed Analysis</h4>
                <div class="details-grid">
                    <div>
                        <div class="detail-item">
                            <div class="detail-label">Power Distance</div>
                            <div id="powerDistance" class="detail-value">0.400</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Uncertainty Avoidance</div>
                            <div id="uncertaintyAvoidance" class="detail-value">0.450</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Long-term Orientation</div>
                            <div id="longTermOrientation" class="detail-value">0.500</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Guardrail Result</div>
                            <div id="guardrailResult" class="detail-value">APPROVED</div>
                        </div>
                    </div>
                    <div>
                        <div class="detail-item">
                            <div class="detail-label">Greek Logic Weight</div>
                            <div id="greekLogic" class="detail-value">0.800</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Scientific Empiricism</div>
                            <div id="scientificEmpiricism" class="detail-value">0.900</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Confucian Precision</div>
                            <div id="confucianPrecision" class="detail-value">0.700</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Violations Detected</div>
                            <div id="violations" class="detail-value">None</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // NOVA Slot 6 Simulation Engine
        class NOVASlot6Engine {
            constructor() {
                this.methodProfile = {
                    "greek_logic": 0.8,
                    "buddhist_impermanence": 0.7,
                    "confucian_precision": 0.7,
                    "indigenous_longterm": 0.8,
                    "scientific_empiricism": 0.9,
                };
                
                this.regionBiases = {
                    "EU": {individualism_index: 0.6, power_distance: 0.45, uncertainty_avoidance: 0.55, long_term_orientation: 0.6},
                    "US": {individualism_index: 0.75, power_distance: 0.4, uncertainty_avoidance: 0.45, long_term_orientation: 0.5},
                    "EA": {individualism_index: 0.45, power_distance: 0.55, uncertainty_avoidance: 0.6, long_term_orientation: 0.7},
                    "LA": {individualism_index: 0.5, power_distance: 0.55, uncertainty_avoidance: 0.55, long_term_orientation: 0.55},
                    "AF": {individualism_index: 0.48, power_distance: 0.58, uncertainty_avoidance: 0.57, long_term_orientation: 0.55},
                    "ME": {individualism_index: 0.44, power_distance: 0.62, uncertainty_avoidance: 0.6, long_term_orientation: 0.6},
                };
                
                this.forbiddenElements = new Set([
                    "divine revelation", "spiritual authority", "faith based claims",
                    "toxic positivity", "cultural supremacy", "mystical bypassing"
                ]);
            }

            analyzeCulturalContext(institutionName, context) {
                const region = context.region || "US";
                const language = context.language || "en";
                const empiricism = context.empiricism_priority || 0.5;
                const foresight = context.foresight_priority || 0.5;

                // Base profile from region
                const base = {
                    individualism_index: 0.5,
                    power_distance: 0.5,
                    uncertainty_avoidance: 0.5,
                    long_term_orientation: 0.5,
                    ...this.regionBiases[region]
                };

                // Language precision bonus
                const precisionBonus = ["de", "el", "fi", "ja"].includes(language) ? 0.05 : 0.0;
                const methodProfile = {...this.methodProfile};
                methodProfile.confucian_precision = Math.min(1.0, methodProfile.confucian_precision + precisionBonus);

                // Calculate adaptation effectiveness
                const adaptationEffectiveness = this.scoreAdaptation(methodProfile, 0.8, foresight, empiricism);

                // Determine cultural context
                let culturalContext = "MIXED";
                if (base.individualism_index >= 0.65) {
                    culturalContext = "INDIVIDUALIST";
                } else if (base.power_distance >= 0.6) {
                    culturalContext = "COLLECTIVIST";
                }

                return {
                    individualism_index: Math.round(base.individualism_index * 1000) / 1000,
                    power_distance: Math.round(base.power_distance * 1000) / 1000,
                    uncertainty_avoidance: Math.round(base.uncertainty_avoidance * 1000) / 1000,
                    long_term_orientation: Math.round(base.long_term_orientation * 1000) / 1000,
                    adaptation_effectiveness: Math.round(adaptationEffectiveness * 1000) / 1000,
                    cultural_context: culturalContext,
                    method_profile: methodProfile,
                    guardrail_compliance: true,
                    principle_preservation_score: 1.0
                };
            }

            validateCulturalDeployment(profile, institutionType, payload) {
                const violations = [];
                const recommendations = [];

                // Scan for forbidden elements
                const content = JSON.stringify(payload).toLowerCase();
                const forbiddenHits = [];
                for (const forbidden of this.forbiddenElements) {
                    if (content.includes(forbidden)) {
                        forbiddenHits.push(forbidden);
                    }
                }

                if (forbiddenHits.length > 0) {
                    violations.push(`FORBIDDEN_ELEMENTS:${forbiddenHits.join(',')}`);
                }

                // Check adaptation bounds
                const maxSafeAdapt = this.maxSafeAdaptation(profile);
                if (profile.adaptation_effectiveness > maxSafeAdapt) {
                    violations.push("ADAPTATION_BOUNDS_EXCEEDED");
                    recommendations.push(`Reduce adaptation_effectiveness to ‚â§ ${maxSafeAdapt.toFixed(2)}`);
                }

                const complianceScore = Math.max(0.0, 1.0 - 0.5 * forbiddenHits.length);

                let result = "APPROVED";
                if (violations.length > 0) {
                    if (violations.includes("ADAPTATION_BOUNDS_EXCEEDED") && forbiddenHits.length === 0) {
                        result = "REQUIRES_TRANSFORMATION";
                    } else {
                        result = forbiddenHits.length > 0 ? "BLOCKED_PRINCIPLE_VIOLATION" : "BLOCKED_ADAPTATION_BOUNDS";
                    }
                }

                return {
                    result,
                    compliance_score: Math.round(complianceScore * 1000) / 1000,
                    violations,
                    recommendations,
                    transformation_required: result === "REQUIRES_TRANSFORMATION",
                    max_safe_adaptation: Math.round(maxSafeAdapt * 1000) / 1000
                };
            }

            scoreAdaptation(methods, clarity, foresight, empiricism) {
                const score = (
                    0.35 * methods.scientific_empiricism * empiricism +
                    0.25 * methods.greek_logic * clarity +
                    0.25 * methods.indigenous_longterm * foresight +
                    0.10 * methods.confucian_precision * clarity +
                    0.05 * methods.buddhist_impermanence * (1 - Math.abs(0.5 - foresight) * 2)
                );
                return Math.max(0.0, Math.min(1.0, score));
            }

            maxSafeAdaptation(profile) {
                const pd = profile.power_distance;
                const ua = profile.uncertainty_avoidance;
                const base = 0.45;
                const penalty = 0.25 * pd + 0.15 * ua;
                return Math.max(0.15, Math.min(0.85, base + (0.15 - penalty)));
            }
        }

        // Initialize the engine
        const engine = new NOVASlot6Engine();
        let currentProfile = null;

        // DOM elements
        const empiricismSlider = document.getElementById('empiricism');
        const foresightSlider = document.getElementById('foresight');
        const empiricismValue = document.getElementById('empiricismValue');
        const foresightValue = document.getElementById('foresightValue');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const testGuardrailsBtn = document.getElementById('testGuardrailsBtn');
        const resultsSection = document.getElementById('resultsSection');

        // Update slider values
        empiricismSlider.addEventListener('input', (e) => {
            empiricismValue.textContent = e.target.value;
        });

        foresightSlider.addEventListener('input', (e) => {
            foresightValue.textContent = e.target.value;
        });

        // Analyze button handler
        analyzeBtn.addEventListener('click', async () => {
            // Show processing state
            analyzeBtn.textContent = 'üîÑ Processing...';
            analyzeBtn.disabled = true;

            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Get form values
            const institutionName = document.getElementById('institutionName').value;
            const region = document.getElementById('region').value;
            const language = document.getElementById('language').value;
            const empiricism = parseFloat(document.getElementById('empiricism').value);
            const foresight = parseFloat(document.getElementById('foresight').value);

            // Analyze cultural context
            const context = {
                region,
                language,
                empiricism_priority: empiricism,
                foresight_priority: foresight,
                clarity_priority: 0.8
            };

            currentProfile = engine.analyzeCulturalContext(institutionName, context);

            // Update UI
            displayResults(currentProfile, null);

            // Reset button
            analyzeBtn.textContent = 'üß™ Analyze Cultural Profile';
            analyzeBtn.disabled = false;
        });

        // Test guardrails button handler
        testGuardrailsBtn.addEventListener('click', async () => {
            if (!currentProfile) {
                alert('Please analyze cultural profile first');
                return;
            }

            const testContent = document.getElementById('testContent').value;
            const institutionType = document.getElementById('institutionType').value;

            const payload = {
                content: testContent,
                messaging: {}
            };

            const guardrailResult = engine.validateCulturalDeployment(currentProfile, institutionType, payload);

            // Update UI with guardrail results
            displayResults(currentProfile, guardrailResult);
        });

        function displayResults(profile, guardrailResult) {
            // Show results section
            resultsSection.classList.remove('hidden');

            // Update metric cards
            document.getElementById('adaptationEffectiveness').textContent = profile.adaptation_effectiveness.toFixed(3);
            document.getElementById('individualismIndex').textContent = profile.individualism_index.toFixed(3);
            document.getElementById('complianceScore').textContent = guardrailResult ? guardrailResult.compliance_score.toFixed(3) : '1.000';
            document.getElementById('culturalContext').textContent = profile.cultural_context;

            // Update detailed values
            document.getElementById('powerDistance').textContent = profile.power_distance.toFixed(3);
            document.getElementById('uncertaintyAvoidance').textContent = profile.uncertainty_avoidance.toFixed(3);
            document.getElementById('longTermOrientation').textContent = profile.long_term_orientation.toFixed(3);
            document.getElementById('guardrailResult').textContent = guardrailResult ? guardrailResult.result : 'NOT_TESTED';
            document.getElementById('greekLogic').textContent = profile.method_profile.greek_logic.toFixed(3);
            document.getElementById('scientificEmpiricism').textContent = profile.method_profile.scientific_empiricism.toFixed(3);
            document.getElementById('confucianPrecision').textContent = profile.method_profile.confucian_precision.toFixed(3);
            document.getElementById('violations').textContent = guardrailResult && guardrailResult.violations.length > 0 ? guardrailResult.violations.join(', ') : 'None';

            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
