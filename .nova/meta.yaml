# Nova Civilizational Architecture — System Metadata
# This file is the entry point for all agents, CLI tools, and external systems.
# It reflects Nova's current state and provides navigation to the architecture.
#
# Maintenance: Semi-automated
# - Slot map, docs paths: hand-curated (stable)
# - Runtime state (commit, maturity, tests): generated by tools/nova-welcome.sh
# - Update when: new slots added, docs reorganized, major phase transitions
#
# Philosophy: This file demonstrates Nova principles while teaching them.
# - Provenance: Links to sources of truth (git, maturity.yaml, audit reports)
# - Immutability: Metadata is versioned; changes produce new commits
# - Observability: Points to runtime introspection endpoints
# - Reversibility: No behavioral logic here; pure navigation

meta:
  schema_version: "1.0.0"
  last_updated: "2025-11-17"
  maintainer: "Nova Core Team"
  purpose: "Active map of Nova's architecture, ontology, and runtime state"

system:
  name: "Nova Civilizational Architecture"
  tagline: "Observe → Canonize → Attest → Publish"
  description: >
    A 10-slot AI governance system implementing provenance-first,
    immutable attestation, and civilizational-scale safety protocols.

  phase: "Phase 17 — Tech Debt & Optimization"
  maturity_level: "4.0 (Processual)"
  status: "stable"

# ============================================================================
# ONTOLOGY — The Nova Way of Thinking
# ============================================================================

ontology:
  rule_of_sunlight: "Observe → Canonize → Attest → Publish"

  core_invariants:
    - name: "Separation of Roles"
      rule: "Slots interpret; Core attests; never collapse the boundary"
    - name: "Provenance First"
      rule: "Cite inputs, assumptions, confidence; no orphaned claims"
    - name: "Immutability at Attest"
      rule: "Same canonical body → same digest; corrections are new events"
    - name: "Reversibility by Default"
      rule: "Feature flags, fast rollback; off-by-default for risky changes"
    - name: "Transparent Uncertainty"
      rule: "Label ignorance; don't hide gaps with false confidence"
    - name: "Observability Always"
      rule: "Export metrics; no SSH spelunking; failures visible in sunlight"

  three_ledgers:
    fact_ledger:
      purpose: "Raw observations, append-only"
      example: "git commits, sensor readings, user events"
    claim_ledger:
      purpose: "Slot interpretations with assumptions + confidence"
      example: "Slot2 ΔTHRESH analysis, Slot6 cultural synthesis"
    attest_ledger:
      purpose: "Hash-linked, optionally signed events (tamper-evident)"
      example: "Slot1 truth anchors, Slot9 audit chains"

  primer: "agents/nova_ai_operating_framework.md"

# ============================================================================
# LEARNING PATH — How to Understand Nova Deeply
# ============================================================================

learning_path:
  phase1_orientation:
    goal: "Understand Nova's mental model and architectural boundaries"
    duration: "~15 minutes"
    steps:
      - read: "agents/nova_ai_operating_framework.md"
        focus: ["Rule of Sunlight", "3 ledgers", "6 invariants", "first 10min checklist"]
      - read: "docs/architecture.md"
        focus: ["10 slot map", "orchestrator role", "inter-slot contracts"]
      - read: "docs/slots/*.md"
        focus: ["Each slot's purpose", "contract stability", "inter-dependencies"]

  phase2_introspection:
    goal: "Probe current system state and verify understanding"
    duration: "~10 minutes"
    steps:
      - read: "src/nova/slots/*/meta.yaml"
        focus: ["Slot versions", "feature flags", "contract schemas", "dependencies"]
      - read: "orchestrator/app.py"
        focus: ["Slot registration", "lifespan manager", "error boundaries"]
      - run: "pytest -q -m 'not slow'"
        expect: "1435 tests passing (1443 total collected)"
      - run: "npm run maturity"
        expect: "overall: 4.0, all slots Processual"

  phase3_observability:
    goal: "Understand runtime metrics and health monitoring"
    duration: "~10 minutes"
    steps:
      - read: "orchestrator/prometheus_metrics.py"
        focus: ["Metric naming (nova_slotN_*)", "flag gauges", "slot health"]
      - read: "src/nova/slots/slot07_production_controls/flag_metrics.py"
        focus: ["Feature flag observability", "runtime introspection"]
      - run: "NOVA_ENABLE_PROMETHEUS=1 uvicorn orchestrator.app:app"
        then: "curl localhost:8000/metrics | grep nova_"
        expect: "Prometheus metrics with flag states, slot health"

  phase4_change_protocol:
    goal: "Learn how to propose reversible, sunlight-safe changes"
    duration: "~10 minutes"
    steps:
      - read: "agents/nova_ai_operating_framework.md"
        section: "Change policy (§5), Pre-merge checklist (§11)"
      - read: ".env.example"
        focus: ["NOVA_* feature flags", "default states (0=off)"]
      - experiment: "Add a new flag, gate behavior, write test, verify rollback"
      - verify: "Toggle flag → behavior reverts without code changes"

# ============================================================================
# ARCHITECTURE — Canonical Slot Map
# ============================================================================

slots:
  slot01:
    name: "Truth Anchor"
    slug: "slot01_truth_anchor"
    purpose: "Foundational truth anchoring with cryptographic RealityLock"
    doc: "docs/slots/slot01_truth_anchor.md"
    meta: "src/nova/slots/slot01_truth_anchor/meta.yaml"
    maturity: 4.0
    contracts_provided: ["anchor.compute", "anchor.verify", "anchor.recover"]

  slot02:
    name: "ΔTHRESH Integration Manager"
    slug: "slot02_deltathresh"
    purpose: "ΔΣΘΩ pattern detection, TRI calculation, adaptive thresholds"
    doc: "docs/slots/slot02_deltathresh.md"
    maturity: 4.0
    contracts_provided: ["delta.analyze", "tri.compute"]

  slot03:
    name: "Emotional Matrix"
    slug: "slot03_emotional_matrix"
    purpose: "Emotional state analysis and affective computing"
    doc: "docs/slots/slot03_emotional_matrix.md"
    maturity: 4.0
    contracts_provided: ["emotion.analyze"]

  slot04:
    name: "TRI Engine"
    slug: "slot04_tri"
    purpose: "Trust-Reciprocity-Integrity scoring and constellation linking"
    doc: "docs/slots/slot04_tri.md"
    meta: "src/nova/slots/slot04_tri/meta.yaml"
    maturity: 4.0
    contracts_provided: ["tri.score", "tri.validate"]
    feature_flags: ["NOVA_ENABLE_TRI_LINK"]

  slot05:
    name: "Constellation"
    slug: "slot05_constellation"
    purpose: "Multi-agent coordination and federated truth consensus"
    doc: "docs/slots/slot05_constellation.md"
    meta: "src/nova/slots/slot05_constellation/meta.yaml"
    maturity: 4.0
    contracts_provided: ["constellation.register", "constellation.query"]

  slot06:
    name: "Cultural Synthesis"
    slug: "slot06_cultural_synthesis"
    purpose: "Cross-cultural pattern analysis and synthesis"
    doc: "docs/slots/slot06_cultural_synthesis.md"
    maturity: 4.0
    contracts_provided: ["culture.analyze", "culture.synthesize"]

  slot07:
    name: "Production Controls"
    slug: "slot07_production_controls"
    purpose: "Feature flags, circuit breakers, operational safety gates"
    doc: "docs/slots/slot07_production_controls.md"
    maturity: 4.0
    contracts_provided: ["flags.check", "circuit.trip"]

  slot08:
    name: "Memory Ethics Guard"
    slug: "slot08_memory_lock"
    purpose: "Ethical memory handling and consent enforcement"
    doc: "docs/slots/slot08_memory_guard.md"
    maturity: 4.0
    contracts_provided: ["memory.store", "memory.recall", "consent.check"]

  slot09:
    name: "Distortion Protection"
    slug: "slot09_distortion_protection"
    purpose: "Adversarial detection, audit chain integrity"
    doc: "docs/slots/slot09_distortion_protection.md"
    meta: "src/nova/slots/slot09_distortion_protection/meta.yaml"
    maturity: 4.0
    contracts_provided: ["distortion.detect", "audit.verify"]
    feature_flags: ["NOVA_USE_SHARED_HASH"]

  slot10:
    name: "Civilizational Deployment"
    slug: "slot10_civilizational_deployment"
    purpose: "Consent profiles, deployment ethics, civilizational-scale safety"
    doc: "docs/slots/slot10_civilizational_deployment.md"
    meta: "src/nova/slots/slot10_civilizational_deployment/meta.yaml"
    maturity: 4.0
    contracts_provided: ["consent.validate", "deployment.authorize"]

# ============================================================================
# RUNTIME INTROSPECTION — Where to Look for Live State
# ============================================================================

runtime:
  git:
    command: "git log -1 --format='%h %ai %s'"
    provides: ["current commit", "timestamp", "phase label"]

  maturity:
    command: "npm run maturity"
    schema: "docs/maturity.yaml"
    provides: ["overall score (0-4)", "per-slot maturity", "test counts"]

  audit:
    latest_report: ".artifacts/audit_master_summary.md"
    date: "2025-11-13"
    phase: "Phase 16.2"
    findings: ["1 CRITICAL auth issue", "7 CVEs", "0% rate-limit coverage"]

  tests:
    command: "pytest -q -m 'not slow'"
    expected_pass_count: 1435
    total_collected: 1443
    coverage_target: "85% (configurable thresholds)"

  metrics:
    endpoint: "http://localhost:8000/metrics"
    enabled_by: "NOVA_ENABLE_PROMETHEUS=1"
    naming_convention: "nova_slotN_* for slot-specific, nova_* for system-wide"
    examples:
      - "nova_feature_flag_enabled{flag='NOVA_ENABLE_TRI_LINK'}"
      - "nova_slot1_anchor_count"
      - "nova_slot6_p95_residual_risk"

  feature_flags:
    registry: ".env.example"
    convention: "NOVA_ENABLE_* / NOVA_USE_*"
    default_state: "0 (off)"
    observability: "Exposed via Prometheus flag_metrics when NOVA_ENABLE_PROMETHEUS=1"
    known_flags:
      - NOVA_ENABLE_TRI_LINK
      - NOVA_ENABLE_LIFESPAN
      - NOVA_USE_SHARED_HASH
      - NOVA_ENABLE_PROMETHEUS
      - NOVA_ENABLE_META_LENS
      - NOVA_ENABLE_CREATIVITY_METRICS
      - NOVA_ENABLE_PROBABILISTIC_CONTRACTS

# ============================================================================
# AGENT PROTOCOL — How External Agents Should Behave
# ============================================================================

agent_protocol:
  consent_required: true
  default_mode: "read_only"
  escalation_path: "Request CONSENT_PROFILE from Slot10 before write operations"

  entry_flow:
    step1: "Run tools/nova-welcome.sh (prints this metadata + live state)"
    step2: "Follow learning_path.phase1_orientation"
    step3: "Declare capabilities and consent profile to Slot10"
    step4: "Receive scoped access credentials"
    step5: "Operate within granted scope; log all actions to attest ledger"

  sunlight_enforcement:
    - "All agent actions must be observable (logged, metered, auditable)"
    - "No hidden side-channels or bypass mechanisms"
    - "Failures are visible; no silent degradation"
    - "Consent can be revoked; agents must handle graceful shutdown"

  self_introduction_template:
    agent_id: "uuid or stable identifier"
    capabilities: ["list of skills/tools"]
    consent_profile: "CE001.standard | CE002.restricted | custom"
    provenance: "organization, version, audit trail"

# ============================================================================
# DOCUMENTATION INDEX — Where to Find Deep Knowledge
# ============================================================================

docs:
  architecture:
    - path: "docs/architecture.md"
      topics: ["10-slot system map", "orchestrator", "plugin model"]
    - path: "docs/architecture/SYSTEM_ARCHITECTURE.md"
      topics: ["detailed design", "inter-slot flows"]

  contracts:
    - path: "docs/INTERSLOT_CONTRACTS.md"
      topics: ["contract stability levels", "versioning policy"]
    - path: "docs/CONTRACT_VERSIONING.md"
      topics: ["breaking changes", "schema evolution"]

  operations:
    - path: "docs/RUNBOOKS.md"
      topics: ["incident response", "operational procedures"]
    - path: "docs/ops/observability.md"
      topics: ["monitoring setup", "dashboard imports", "alert rules"]

  releases:
    - path: "docs/releases/"
      topics: ["phase changelogs", "migration guides"]

  reflections:
    - path: "docs/reflections/"
      topics: ["philosophical evolution", "design decisions", "wisdom integration"]

# ============================================================================
# CHANGELOG — Evolution of This Metadata File
# ============================================================================

changelog:
  - version: "1.0.0"
    date: "2025-11-17"
    changes: "Initial active map: ontology, learning path, slot canon, agent protocol"
    rationale: "Agent entry protocol needed self-aware navigation index"
