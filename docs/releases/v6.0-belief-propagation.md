# Nova Phase 6.0 — Probabilistic Belief Propagation

## Release Overview

**Date:** October 2025
**Phase:** 6.0
**Title:** Probabilistic Belief Propagation
**Tag:** `v6.0-belief-propagation`

## Executive Summary

Phase 6.0 introduces probabilistic belief propagation between Slot 04 (TRI Engine) and Slot 07 (Production Controls), enabling uncertainty quantification in cross-slot communication. This provides graceful degradation during mirror outages while maintaining existing contract interfaces and Prometheus observability.

## Key Features

### Probabilistic Belief States
- **BeliefState Schema:** Mean, variance, timestamp, and derived confidence
- **Bayesian Updates:** Precision-weighted fusion for uncertainty quantification
- **Graceful Degradation:** Monotonic variance growth during outages, automatic recovery

### Cross-Slot Integration
- **TRI → Production Controls:** Belief propagation for phase lock signals
- **Environment Gating:** `NOVA_ENABLE_PROBABILISTIC_CONTRACTS` flag (default enabled)
- **Backward Compatibility:** All existing interfaces preserved

### Observability Enhancements
- **New Metrics:** `nova_slot_phase_lock_belief_mean{slot="4|7"}` and variance gauges
- **Alert Integration:** Variance-based thresholds for operational triggers
- **Provenance Tracking:** JSONL receipts for belief state updates

## Architecture Changes

### Core Components
- `src/nova/belief_contracts.py`: Belief state schema and Bayesian update logic
- `src/nova/slots/slot04_tri/core/tri_engine.py`: Belief publication integration
- `src/nova/slots/slot07_production_controls/production_control_engine.py`: Belief consumption
- `orchestrator/prometheus_metrics.py`: Belief state metric export

### Safety Guarantees
- **Numerical Stability:** All operations clamped to [0,1] with epsilon protection
- **Conservative Defaults:** Cold start with mean=0.5, variance=0.1
- **Monotonic Operations:** Variance never decreases during outages
- **Environment Toggles:** Complete feature disable via flags

## Operational Impact

### Production Controls Integration
- **Soft Throttle:** Variance > 0.20 triggers rate reduction
- **Circuit Breaker:** Variance > 0.25 sustained trips breaker
- **Auto Recovery:** Variance < 0.10 clears alerts and resumes normal operation

### Monitoring Dashboard
- **Variance as Confidence:** Lower variance = higher system certainty
- **Staleness Tracking:** Alert on belief state update gaps
- **Drift Detection:** Monitor extreme mean deviations from neutral (0.5)

## Testing & Validation

### Test Coverage
- **Convergence Tests:** Belief fusion under consistent signals
- **Outage Simulation:** Graceful degradation verification
- **Numerical Stability:** Edge case handling (NaN/Inf prevention)
- **Publication Toggles:** Environment flag compliance

### CI/CD Integration
- **Provenance Receipts:** JSONL logging with timestamps and hashes
- **Metrics Validation:** Block merges with invalid belief states
- **Artifact Hashing:** PDF and receipt integrity verification

## Rollout Strategy

### Phase 1: Shadow Mode (Metrics Only)
- Enable belief computation and metric export
- No operational coupling to production controls
- Goal: Safe observation and threshold tuning

### Phase 2: Soft-Coupled Mode
- Production controls read variance but act gently
- Tune operational thresholds based on observed patterns
- Goal: Gradual integration with monitoring

### Phase 3: Hard-Coupled Mode
- Full autonomy with variance-based circuit breaker trips
- Complete probabilistic safety integration
- Goal: Production deployment with rollback capability

## Risk Assessment

### Identified Risks & Mitigations
- **Cold-start Bias:** Neutral initialization with documented defaults
- **Numerical Drift:** Comprehensive clamping and epsilon protection
- **Masked Faults:** Clear "acted due to uncertainty" event logging
- **Human Misinterpretation:** Annotated dashboards with operational meaning
- **Metric Flooding:** Rate-limited belief publications

### Rollback Plan
```bash
export NOVA_ENABLE_PROBABILISTIC_CONTRACTS=0
# Restart services - reverts to pre-Phase 6.0 behavior
```

## Compatibility Matrix

| Component | Compatibility | Notes |
|-----------|---------------|-------|
| Phase 5.1 ANR | ✅ Compatible | Belief propagation extends ANR routing |
| Existing Contracts | ✅ Preserved | No interface changes |
| Prometheus Metrics | ✅ Extended | New gauges alongside existing |
| Mirror Communication | ✅ Enhanced | Belief states published alongside scalars |

## Future Roadmap

Phase 6.0 establishes the foundation for:
- **Phase 6.1:** Multi-slot belief propagation (TRI → Emotional Matrix → Cultural Synthesis)
- **Phase 6.2:** Belief-based decision trees for complex operational scenarios
- **Phase 7.0:** Civilizational-scale uncertainty quantification

## Attestation

See `attest/2025-10-phase-6.0-belief-propagation.json` for formal provenance claims and confidence levels.

## Documentation

- **Engineering Note:** `docs/engineering-notes/v6.0-probabilistic-belief-propagation.md`
- **Contract Schema:** `contracts/slot04-07-belief-state.yaml`
- **Runbook:** `ops/runbook/belief-state-daily-checklist.md`

---

*Phase 6.0 continues Nova's evolution from deterministic slot orchestration to probabilistic, uncertainty-aware civilizational architecture.*